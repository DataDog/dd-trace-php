--TEST--
Maps with more than 256 entries are truncated
--INI--
datadog.appsec.enabled=1
display_errors=1
--ENV--
DD_TRACE_GENERATE_ROOT_SPAN=0
--COOKIE--
d['1']=1; d['2']=2; d['3']=3; d['4']=4; d['5']=5; d['6']=6; d['7']=7; d['8']=8; d['9']=9; d['10']=10; d['11']=11; d['12']=12; d['13']=13; d['14']=14; d['15']=15; d['16']=16; d['17']=17; d['18']=18; d['19']=19; d['20']=20; d['21']=21; d['22']=22; d['23']=23; d['24']=24; d['25']=25; d['26']=26; d['27']=27; d['28']=28; d['29']=29; d['30']=30; d['31']=31; d['32']=32; d['33']=33; d['34']=34; d['35']=35; d['36']=36; d['37']=37; d['38']=38; d['39']=39; d['40']=40; d['41']=41; d['42']=42; d['43']=43; d['44']=44; d['45']=45; d['46']=46; d['47']=47; d['48']=48; d['49']=49; d['50']=50; d['51']=51; d['52']=52; d['53']=53; d['54']=54; d['55']=55; d['56']=56; d['57']=57; d['58']=58; d['59']=59; d['60']=60; d['61']=61; d['62']=62; d['63']=63; d['64']=64; d['65']=65; d['66']=66; d['67']=67; d['68']=68; d['69']=69; d['70']=70; d['71']=71; d['72']=72; d['73']=73; d['74']=74; d['75']=75; d['76']=76; d['77']=77; d['78']=78; d['79']=79; d['80']=80; d['81']=81; d['82']=82; d['83']=83; d['84']=84; d['85']=85; d['86']=86; d['87']=87; d['88']=88; d['89']=89; d['90']=90; d['91']=91; d['92']=92; d['93']=93; d['94']=94; d['95']=95; d['96']=96; d['97']=97; d['98']=98; d['99']=99; d['100']=100; d['101']=101; d['102']=102; d['103']=103; d['104']=104; d['105']=105; d['106']=106; d['107']=107; d['108']=108; d['109']=109; d['110']=110; d['111']=111; d['112']=112; d['113']=113; d['114']=114; d['115']=115; d['116']=116; d['117']=117; d['118']=118; d['119']=119; d['120']=120; d['121']=121; d['122']=122; d['123']=123; d['124']=124; d['125']=125; d['126']=126; d['127']=127; d['128']=128; d['129']=129; d['130']=130; d['131']=131; d['132']=132; d['133']=133; d['134']=134; d['135']=135; d['136']=136; d['137']=137; d['138']=138; d['139']=139; d['140']=140; d['141']=141; d['142']=142; d['143']=143; d['144']=144; d['145']=145; d['146']=146; d['147']=147; d['148']=148; d['149']=149; d['150']=150; d['151']=151; d['152']=152; d['153']=153; d['154']=154; d['155']=155; d['156']=156; d['157']=157; d['158']=158; d['159']=159; d['160']=160; d['161']=161; d['162']=162; d['163']=163; d['164']=164; d['165']=165; d['166']=166; d['167']=167; d['168']=168; d['169']=169; d['170']=170; d['171']=171; d['172']=172; d['173']=173; d['174']=174; d['175']=175; d['176']=176; d['177']=177; d['178']=178; d['179']=179; d['180']=180; d['181']=181; d['182']=182; d['183']=183; d['184']=184; d['185']=185; d['186']=186; d['187']=187; d['188']=188; d['189']=189; d['190']=190; d['191']=191; d['192']=192; d['193']=193; d['194']=194; d['195']=195; d['196']=196; d['197']=197; d['198']=198; d['199']=199; d['200']=200; d['201']=201; d['202']=202; d['203']=203; d['204']=204; d['205']=205; d['206']=206; d['207']=207; d['208']=208; d['209']=209; d['210']=210; d['211']=211; d['212']=212; d['213']=213; d['214']=214; d['215']=215; d['216']=216; d['217']=217; d['218']=218; d['219']=219; d['220']=220; d['221']=221; d['222']=222; d['223']=223; d['224']=224; d['225']=225; d['226']=226; d['227']=227; d['228']=228; d['229']=229; d['230']=230; d['231']=231; d['232']=232; d['233']=233; d['234']=234; d['235']=235; d['236']=236; d['237']=237; d['238']=238; d['239']=239; d['240']=240; d['241']=241; d['242']=242; d['243']=243; d['244']=244; d['245']=245; d['246']=246; d['247']=247; d['248']=248; d['249']=249; d['250']=250; d['251']=251; d['252']=252; d['253']=253; d['254']=254; d['255']=255; d['256']=256; d['257']=257; d['258']=258
--FILE--
<?php
use function datadog\appsec\testing\{rinit,rshutdown};

include __DIR__ . '/inc/mock_helper.php';

$helper = Helper::createInitedRun([
    response_list(response_request_init([[['ok', []]]])),
    response_list(response_request_shutdown([[['ok', []]], [], false, [],
    [], [], ["waf.requests" => [[2.0, ""], [1.0, "a=b"]]]]))
]);

rinit();
rshutdown();

$commands = $helper->get_commands();
var_dump(count($commands[1][1][0]['server.request.cookies']['d']));
?>
--EXPECTF--
Notice: datadog\appsec\testing\rshutdown(): Would call ddtrace_metric_register_buffer with name=waf.requests type=1 ns=3 in %s on line %d

Notice: datadog\appsec\testing\rshutdown(): Would call to ddtrace_metric_add_point with name=waf.requests value=2.000000 tags=input_truncated=true in %s on line %d

Notice: datadog\appsec\testing\rshutdown(): Would call ddtrace_metric_register_buffer with name=waf.requests type=1 ns=3 in %s on line %d

Notice: datadog\appsec\testing\rshutdown(): Would call to ddtrace_metric_add_point with name=waf.requests value=1.000000 tags=a=b,input_truncated=true in %s on line %d
int(256)