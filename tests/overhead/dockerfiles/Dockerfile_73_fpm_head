FROM overhead-php-fpm-base

ENV TESTING_ENVIRONMENT=head

WORKDIR /dd-trace-php

COPY ./src/ ./src/
COPY ./m4/ ./m4/
COPY ./bridge/ ./bridge/
COPY Makefile composer* config.m4 ./

ENV DD_REQUEST_INIT_HOOK=/dd-trace-php/bridge/dd_wrap_autoloader.php

RUN set -xe; \
    composer install-ext -- -j $(nproc);
