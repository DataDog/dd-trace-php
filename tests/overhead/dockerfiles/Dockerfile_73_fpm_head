FROM overhead-php-fpm-base

ENV TESTING_ENVIRONMENT=head

WORKDIR /dd-trace-php

COPY ./src/ ./src/
COPY ./m4/ ./m4/
COPY ./bridge/ ./bridge/
COPY Makefile composer* config.m4 ./

RUN set -xe; \
    composer install-ext -- -j $(nproc); \
    echo "ddtrace.request_init_hook=/dd-trace-php/bridge/dd_wrap_autoloader.php" >> /usr/local/etc/php/conf.d/ddtrace.ini
