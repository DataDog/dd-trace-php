<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
//phpcs:disable Squiz.ControlStructures.ControlSignature.NewlineAfterOpenBrace
//phpcs:disable Squiz.WhiteSpace.ScopeClosingBrace.ContentBefore
//phpcs:disable Squiz.Operators.IncrementDecrementUsage.NotAllowed
//phpcs:disable Squiz.PHP.NonExecutableCode.Unreachable
?>
<div class="grid">
    <?php $randomId = rand(); ?>
    <div class="admin__table-wrapper">
        <table class="data-grid">
            <thead>
                <tr>
                    <th class="data-grid-checkbox-cell">
                        <label class="data-grid-checkbox-cell-inner">
                            <input type="checkbox"
                                   id="select-items-<?= /* @noEscape */ $randomId ?>"
                                   onchange="packaging.checkAllItems(this);"
                                   class="checkbox admin__control-checkbox"
                                   title="<?= $block->escapeHtmlAttr(__('Select All')) ?>">
                            <label for="select-items-<?= /* @noEscape */ $randomId ?>"></label>
                        </label>
                    </th>
                    <th class="data-grid-th"><?= $block->escapeHtml(__('Product Name')) ?></th>
                    <th class="data-grid-th"><?= $block->escapeHtml(__('Weight')) ?></th>
                    <th class="data-grid-th" <?= $block->displayCustomsValue() ? '' : 'style="display: none;"' ?>>
                        <?= $block->escapeHtml(__('Customs Value')) ?>
                    </th>
                    <th class="data-grid-th"><?= $block->escapeHtml(__('Qty Ordered')) ?></th>
                    <th class="data-grid-th"><?= $block->escapeHtml(__('Qty')) ?></th>
                </tr>
            </thead>
            <tbody>
            <?php $i=0; ?>
            <?php foreach ($block->getCollection() as $item) : ?>
                <?php
                    $_order = $block->getShipment()->getOrder();
                    $_orderItem = $_order->getItemById($item->getOrderItemId());
                ?>
                <?php if ($item->getIsVirtual()
                    || ($_orderItem->isShipSeparately()
                        && !($_orderItem->getParentItemId() || $_orderItem->getParentItem()))
                    || (!$_orderItem->isShipSeparately()
                        && ($_orderItem->getParentItemId() || $_orderItem->getParentItem()))) : ?>
                    <?php continue; ?>
                <?php endif; ?>
                <tr class="data-grid-controls-row data-row <?= ($i++ % 2 != 0) ? '_odd-row' : '' ?>">
                    <td class="data-grid-checkbox-cell">
                        <?php $id = $item->getId() ? $item->getId() : $item->getOrderItemId(); ?>
                        <label class="data-grid-checkbox-cell-inner">
                            <input type="checkbox"
                                   name=""
                                   id="select-item-<?= /* @noEscape */ $randomId . '-' . $id ?>"
                                   value="<?= (int) $id ?>"
                                   class="checkbox admin__control-checkbox">
                            <label for="select-item-<?= /* @noEscape */ $randomId . '-' . $id ?>"></label>
                        </label>
                    </td>
                    <td>
                        <?= $block->escapeHtml($item->getName()) ?>
                    </td>
                    <td data-role="item-weight">
                        <?= $block->escapeHtml($item->getWeight()) ?>
                    </td>
                    <?php
                    if ($block->displayCustomsValue()) {
                        $customsValueDisplay = '';
                        $customsValueValidation = ' validate-zero-or-greater ';
                    } else {
                        $customsValueDisplay = ' style="display: none;" ';
                        $customsValueValidation = '';
                    }

                    ?>
                    <td <?= /* @noEscape */ $customsValueDisplay ?>>
                        <input type="text"
                               name="customs_value"
                               class="input-text admin__control-text <?= /* @noEscape */ $customsValueValidation ?>"
                               value="<?= $block->escapeHtmlAttr($block->formatPrice($item->getPrice())) ?>"
                               size="10"
                               onblur="packaging.recalcContainerWeightAndCustomsValue(this);">
                    </td>
                    <td>
                        <?= /* @noEscape */ $item->getOrderItem()->getQtyOrdered()*1 ?>
                    </td>
                    <td>
                        <input type="hidden" name="price" value="<?= $block->escapeHtmlAttr($item->getPrice()) ?>">
                        <input type="text"
                               name="qty"
                               value="<?= /* @noEscape */ $item->getQty()*1 ?>"
                               class="input-text admin__control-text qty
                            <?php if ($item->getOrderItem()->getIsQtyDecimal()) : ?>
                               qty-decimal
                            <?php endif ?>">&nbsp;
                        <button type="button"
                                class="action-delete"
                                data-action="package-delete-item"
                                onclick="packaging.deleteItem(this);"
                                style="display:none;">
                            <span><?= $block->escapeHtml(__('Delete')) ?></span>
                        </button>
                    </td>
                </tr>
            <?php endforeach; ?>
            </tbody>
        </table>
    </div>
</div>
